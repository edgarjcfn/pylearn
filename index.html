<html> 
<head>
   <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.0/jquery.min.js" type="text/javascript"></script> 

  <script src="bower_components/skulpt/skulpt.min.js" type="text/javascript"></script> 
  <script src="bower_components/skulpt/skulpt-stdlib.js" type="text/javascript"></script> 
  <script src="bower_components/ace-builds/src-min/ace.js"></script>
  <script src="bower_components/phaser/build/phaser.js"></script>
  <script src="bower_components/phaser-plugin-isometric/dist/phaser-plugin-isometric.js"></script>

  <script src="pylearn/dist/pylearn.js"></script>
  
  <style type="text/css" media="screen">
  #editor { 
    position: absolute;
    top: 40;
    right: 0;
    bottom: 0;
    left: 0;
    width:40%;
    height:600;
    float:left;
  }

  #gameContainer {
    border:0 40 0 0; 
    width:60%; 
    height:600px; 
    float:right
  }
  </style>

</head> 

<body>

  <button type="button" onclick="runPython()">Run</button> 
  
<div id="editor">import mygame

char = mygame.Character();

"""
" Do a square lap
"""
char.turnRight();
char.moveForward(3);
char.turnRight();
char.moveForward(3);
char.turnRight();
char.moveForward(3);
char.turnRight();
char.moveForward(3);

"""
" Do a Zig-Zag
"""
char.turnRight();
for x in range(0,3):
    char.moveForward(1);
    char.turnRight();
    char.moveForward(1);
    char.turnLeft();
"""
" Attack!
"""
char.attack();
char.turnLeft();
char.moveForward(3);
char.attack();
char.turnLeft();
char.moveForward(3);
char.attack();

  </div><br /> 

  <div id="gameCanvas" style="float:right; width:60%; height:600px">
  </div>
  


  <script type="text/javascript">
  $(document).ready(function()
  {
    var editor = ace.edit("editor");
    editor.setTheme("ace/theme/monokai");
    editor.getSession().setMode("ace/mode/python");
    editor.setFontSize('16pt');
    editor.setHighlightActiveLine(true);

  });
  </script>

  <script id="skulpt" type="text/javascript"> 
// output functions are configurable.  This one just appends some text
// to a pre element.
function builtinRead(x) {
  if (Sk.builtinFiles === undefined || Sk.builtinFiles["files"][x] === undefined)
    throw "File not found: '" + x + "'";
  return Sk.builtinFiles["files"][x];
}

function runPython() { 
  var prog = ace.edit("editor").getValue(); 

  Sk.externalLibraries = {
    mygame : {
      path : 'pylearn/dist/pylearn.skulpt.js',
      dependencies : []
    },
  };
  Sk.commandChain = new Pylearn.Command.CommandQueue(updateLine);
    // Sk.pre = "output";
    Sk.configure({read:builtinRead});

    try {
      eval(Sk.importMainWithBody("<stdin>",false,prog));
      Sk.commandChain.execute();
    }
    catch(e) {
      //console.debug('error', e);
      throw e
    }
  } 

  function updateLine(lineNumber) {
    var editor = ace.edit("editor");
    editor.gotoLine(lineNumber);
    console.debug('current line', lineNumber);
  }
  </script>

</body> 

</html> 